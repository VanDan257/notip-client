<div class="main-panel">
  <div class="content-wrapper">
    <div class="page-header">
      <h3 class="page-title"> Danh sách nhân viên </h3>
      <nav aria-label="breadcrumb">
        <button class="btn btn-info btn-rounded" (click)="onCreateStaff()">Thêm nhân viên</button>
      </nav>
    </div>
    <table class="table table-bordered table-striped table-hover">
      <thead class="table-dark">
      <tr>
        <th></th>
        <th style="width: 20%">Họ và tên</th>
        <th style="width: 10%">Số điện thoại</th>
        <th style="width: 10%">Email</th>
        <th style="width: 10%">Giới tính</th>
        <th style="width: 15%">Lần đăng nhập cuối</th>
        <th style="width: 10%">Trạng thái</th>
        <th style="width: 15%">Ngày đăng kí</th>
        <th></th>
      </tr>
      </thead>
      <tbody *ngIf="users.length > 0">
      <tr *ngFor="let user of users | paginate: { itemsPerPage: pageSize, currentPage: pageNumber }">
        <td><img src="{{ user.avatar | pipeHostFile }}" alt="" /></td>
        <td style="width: 20%">{{user.name}}</td>
        <td style="width: 10%">{{user.phone}}</td>
        <td style="width: 10%">{{user.email}}</td>
        <td style="width: 10%">{{user.gender}}</td>
        <td style="width: 15%">{{user.lastLogin}}</td>
        <td style="width: 10%">
          <ng-container *ngIf="user.status === true">
            <label class="badge badge-success">Hoạt động</label>
          </ng-container>
          <ng-container *ngIf="user.status === false">
            <label class="badge badge-warning">Đã khóa</label>
          </ng-container>
        </td>
        <td style="width: 15%">{{user.createdAt | date:'short'}}</td>
        <td>
          <button href="#" title="Xem chi tiết" class="link-info btn-option"><i class="fa fa-solid fa-eye"></i></button> |
          <button href="#" title="Chỉnh sửa" class="link-primary btn-option"><i class="fa fa-solid fa-pen"></i></button> |
          <button title="Xóa" (click)="onDeleteStaff(user)" class="link-danger btn-option"><i class="fa fa-solid fa-trash"></i></button>
        </td>
      </tr>
      </tbody>
    </table>
    <div class="d-flex mt-4 flex-wrap">
      <p class="text-muted">Showing {{1+pageSize*(pageNumber-1)}} to
        <ng-container *ngIf="(10+pageSize*(pageNumber-1)) >= users.length">
          {{users.length}}
        </ng-container>
        <ng-container *ngIf="(10+pageSize*(pageNumber-1)) < users.length">
          {{10+pageSize*(pageNumber-1)}}
        </ng-container>
        of {{users.length}} entries</p>
      <nav class="ml-auto">
        <pagination-controls (pageChange)="pageNumber = $event"></pagination-controls>
      </nav>
    </div>
  </div>
</div>

<div class="modal fade" id="modalCreateStaff">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="row">
        <div class="col-12 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <form  [formGroup]="createStaffForm" (ngSubmit)="createStaff()">
                <h4 class="card-title">Thêm mới nhân viên</h4>
                  <div class="form-group">
                    <label for="exampleInputName1">Họ và tên</label>
                    <input
                      type="text"
                      class="form-control"
                      id="exampleInputName1"
                      formControlName="name"
                      [formControl]="$any(createStaffForm.controls['name'])"
                      placeholder="Nhập họ và tên">
                    <div class="invalid-feedback" *ngIf="$any(createStaffForm.controls['name']).errors?.['required']">
                      Hãy nhập họ và tên nhân viên
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="exampleInputEmail3">Email</label>
                    <input
                      type="email"
                      class="form-control"
                      id="exampleInputEmail3"
                      formControlName="email"
                      [formControl]="$any(createStaffForm.controls['email'])"
                      placeholder="Nhập địa chỉ email">
                    <div class="invalid-feedback" *ngIf="$any(createStaffForm.controls['email']).errors?.['required']">
                      Hãy nhập email nhân viên
                    </div>
                    <div class="invalid-feedback" *ngIf="$any(createStaffForm.controls['email']).errors?.['checkEmail']">
                      Hãy nhập đúng định dạng email
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPhone">Phone</label>
                    <input
                            type="email"
                            class="form-control"
                            id="exampleInputPhone"
                            formControlName="email"
                            [formControl]="$any(createStaffForm.controls['phone'])"
                            placeholder="Nhập địa chỉ email">
                    <div class="invalid-feedback" *ngIf="$any(createStaffForm.controls['phone']).errors?.['required']">
                      Hãy nhập số điện thoại nhân viên
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword4">Mật khẩu</label>
                    <input
                      type="text"
                      class="form-control"
                      id="exampleInputPassword4"
                      formControlName="password"
                      [formControl]="$any(createStaffForm.controls['password'])"
                      placeholder="Nhập mật khẩu">
                    <div class="invalid-feedback" *ngIf="$any(createStaffForm.controls['password']).errors?.['required']">
                      Hãy nhập mật khẩu
                    </div>
                    <div class="invalid-feedback" *ngIf="$any(createStaffForm.controls['password']).errors?.['minLength']">
                      Nhập tối thiểu 4 ký tự
                    </div>
                    <div class="invalid-feedback" *ngIf="$any(createStaffForm.controls['password']).errors?.['maxLength']">
                      Nhập tối đa 16 ký tự
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="exampleSelectGender">Giới tính</label>
                    <select class="form-control" formControlName="gender" [formControl]="$any(createStaffForm.controls['gender'])" id="exampleSelectGender">
                      <option selected>Nam</option>
                      <option>Nữ</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="exampleSelectGender">Ngày sinh</label>
                    <input
                      type="date"
                      formControlName="dob"
                      [formControl]="$any(createStaffForm.controls['dob'])"
                      class="form-control" >
                  </div>
                  <div class="form-group">
                    <label>Ảnh đại diện</label>
                    <input type="file" name="img[]" (change)="uploadFile($event)" class="form-control" placeholder="Chọn ảnh">
                  </div>
                  <div class="form-group">
                    <label for="exampleInputCity1">Địa chỉ</label>
                    <input
                      type="text"
                      class="form-control"
                      id="exampleInputCity1"
                      formControlName="address"
                      [formControl]="$any(createStaffForm.controls['address'])"
                      placeholder="Nhập địa chỉ">
                  </div>
                  <div class="form-group">
                    <label for="exampleSelectRole">Quyền</label>
                    <select class="form-control" formControlName="role" [formControl]="$any(createStaffForm.controls['role'])" id="exampleSelectRole">
                      <option value="2" selected>Nhân viên</option>
                      <option value="3">Người quản trị</option>
                    </select>
                  </div>
                  <button type="submit" class="btn btn-primary mr-2" [disabled]="!createStaffForm.valid">Thêm mới</button>
                  <button class="btn btn-light">Hủy</button>
                </form>

              </div>
            </div>

        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalDeleteStaff">
  <div class="modal-dialog">
    <div *ngIf="staffDelete != null || staffDelete != undefined" class="modal-content">
      <div class="modal-header">
        <div class="d-flex">
          Bạn có muốn xóa nhân viên: <div style="font-weight: 600;"> {{staffDelete.name}}</div>
        </div>
      </div>
      <div class="d-flex p-3 justify-content-around">
        <button class="btn btn-primary" (click)="deleteStaff(staffDelete.id)">Xác nhận</button>
        <button class="btn btn-dark" data-dismiss="modal">Hủy</button>
      </div>
    </div>
  </div>
</div>
<ngx-spinner bdOpacity="0.9" bdColor="rgba(51,51,51,0.8)" size="medium" type="ball-spin-clockwise">
  <p style="color: white" > Loading... </p>
</ngx-spinner>
